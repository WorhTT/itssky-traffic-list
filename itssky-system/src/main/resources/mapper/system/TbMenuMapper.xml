<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itssky.system.mapper.TbMenuMapper">

	<resultMap type="com.itssky.common.core.domain.entity.TbMenu" id="SysMenuResult">
		<id     property="menuId"         column="menu_id"        />
		<result property="menuName"       column="menu_name"      />
		<result property="parentName"     column="parent_name"    />
		<result property="parentId"       column="parent_id"      />
		<result property="orderNum"       column="order_num"      />
		<result property="path"           column="path"           />
		<result property="component"      column="component"      />
		<result property="menuType"       column="menu_type"      />
		<result property="visible"        column="visible"        />
		<result property="status"         column="status"         />
		<result property="perms"          column="perms"          />
		<result property="icon"           column="icon"           />
	</resultMap>

	<sql id="selectMenuVo">
        select menu_id, menu_name, parent_id, order_num, path, component, `query`, route_name, is_frame, is_cache, menu_type, visible, status, ifnull(perms,'') as perms, icon
		from tbmenu
    </sql>


	<select id="selectMenuTreeAll" resultMap="SysMenuResult" parameterType="Integer">
		select distinct m.menu_id, m.parent_id, m.menu_name, m.path, m.component, m.visible, m.status, ifnull(m.perms,'') as perms, m.menu_type, m.icon, m.order_num
		<!--		from tbmenu m where m.menu_type in ('M', 'C') and m.status = 0-->
		from tbmenu m where m.menu_type in ('C') and m.status = 0 AND m.del_flag = '0'
		<if test="serviceId != null and serviceId != ''">
			and m.service_id = #{serviceId}
		</if>
		order by m.parent_id, m.order_num
	</select>


	<select id="selectMenuTreeByUserId" parameterType="com.itssky.common.core.domain.dto.TbMenuDto" resultMap="SysMenuResult">
		select distinct m.menu_id, m.parent_id, m.menu_name, m.path, m.component, m.visible, m.status, ifnull(m.perms,'') as perms,m.menu_type, m.icon, m.order_num
		from tbmenu m
		left join tbrolemenu rm on m.menu_id = rm.menu_id
		left join tbuserrole ur on rm.role_id = ur.role_id
		left join tbrole ro on ur.role_id = ro.role_id
		left join tbuserinfo u on ur.user_id = u.userid
		<!--		where u.userid = #{userId} and m.menu_type in ('M', 'C') and m.status = 0  AND ro.status = 0-->
		where m.menu_type in ('C') and m.status = 0  AND ro.status = 0 AND m.del_flag = '0'
		<if test="userId != null and userId != ''">
			and u.userid = #{userId}
		</if>
		<if test="serviceId != null and serviceId != ''">
			and m.service_id = #{serviceId}
		</if>
		order by m.parent_id, m.order_num
	</select>

	<select id="selectMenuByIds" parameterType="collection" resultMap="SysMenuResult">
		select a.menu_id, a.menu_name, a.parent_id, a.order_num, a.path, a.component, a.menu_type, a.visible, a.status, ifnull(a.perms,'') as perms, a.icon
		from tbmenu a
		<where>
			menu_id in
			<foreach collection="collection" item="menuId" open="(" separator="," close=")">
				#{menuId}
			</foreach>
			AND del_flag = '0'
		</where>

	</select>
</mapper> 